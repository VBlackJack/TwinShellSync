id: 8f26960c-829b-4e7c-a8f0-6d75c605c5ef
name: Invoke-Sqlcmd
platform: Windows
commandPattern: Invoke-Sqlcmd -ServerInstance '{serverInstance}' -Database 'msdb' -Query "SELECT j.name AS JobName, j.enabled AS IsEnabled, CASE WHEN ja.run_requested_date IS NOT NULL THEN 'Running' WHEN jh.run_status = 1 THEN 'Success' WHEN jh.run_status = 0 THEN 'Failed' ELSE 'Unknown' END AS LastStatus, jh.run_date AS LastRunDate, jh.run_time AS LastRunTime FROM msdb.dbo.sysjobs j LEFT JOIN msdb.dbo.sysjobactivity ja ON j.job_id = ja.job_id AND ja.run_requested_date IS NOT NULL LEFT JOIN (SELECT job_id, run_status, run_date, run_time, ROW_NUMBER() OVER (PARTITION BY job_id ORDER BY run_date DESC, run_time DESC) AS rn FROM msdb.dbo.sysjobhistory WHERE step_id = 0) jh ON j.job_id = jh.job_id AND jh.rn = 1 ORDER BY j.name" | Format-Table -AutoSize
parameters:
- name: serverInstance
  label: Instance SQL Server
  type: string
  defaultValue: localhost
  required: true
  description: Instance SQL Server
